Explosion_Plate <- names(tmp[which(tmp>0)])
#전체 연소 Plate 확인
Explosion_Plate_total <- NULL
for (j in 1:length(Explosion_Plate)){
Explosion_Plate_total <- paste(Explosion_Plate_total,Explosion_Plate[j],sep=" ")
}
tmp_df1 <- tmp_df[,c(1:5,31:55,56:58,62)]
tmp_df1 <- tmp_df1 %>% gather(Collector_num,Presure,Collector_압력_151:Collector_압력_175)
tmp_df1$Num <- str_split_fixed(tmp_df1$Collector_num, fixed("_"), 3)[, 3]
tmp_df1$Collector_num <- NULL
tmp_df2 <- tmp_df[,c(1:30,56:58,62)]
tmp_df2 <- tmp_df2 %>% gather(Plate_num,Current,Plate_전류_151:Plate_전류_175)
tmp_df2$Num <- str_split_fixed(tmp_df2$Plate_num, fixed("_"), 3)[, 3]
tmp_df2$Plate_num <- NULL
tmp_df <- merge(tmp_df1, tmp_df2, by = c("File_num","Item_No","연소여부","Time","전류","Plates전류합","액보충시간","GROUP_endtime","GROUP_starttime", "Num")) %>%
arrange(Time);#rm(tmp_df1,tmp_df2)
tmp_df$Plate_num <- paste0("P_",tmp_df$Num)
tmp_df$Collector_num <- paste0("C_",tmp_df$Num)
tmp_df$Num <- NULL
tmp_df$Time <- as.POSIXct(tmp_df$Time, origin="1899-12-30", tz="GMT")
tmp_df$액보충시간 <- as.POSIXct(tmp_df$액보충시간, origin="1899-12-30", tz="GMT")
#연소발생 1시간전 상위Rank+최하Rank+연소 Plate 선별 Drawing
Flag_Time <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-1, unit="hours")
Tmp_df1 <- tmp_df %>%
filter(Time == Flag_Time) %>%
arrange(desc(Current)) %>%
add_column(Rank=1:25,.before = 'Plate_num') %>%
filter((Rank>=1 & Rank<=5)|Rank==25)
Select_Plate <- Tmp_df1$Plate_num;rm(Tmp_df1)
tmp_df <- tmp_df %>% filter(tmp_df[,'Plate_num'] %in% c(Select_Plate, Explosion_Plate))
min_current <- min(tmp_df$Current, na.rm = T)
max_current <- max(tmp_df$Current, na.rm = T)
min_pressure <- min(tmp_df$Presure, na.rm = T)
max_pressure <- max(tmp_df$Presure, na.rm = T)
p <- ggplot(tmp_df,aes(x=Time,y=Current,group=Plate_num)) + ylim(min_current,max_current) +
geom_line(aes(color=Plate_num))+xlab("Time")+ylab("Plate_Current") +
guides(color = guide_legend(override.aes = list(size = 5))) + scale_color_manual(values=color)
p <- p + coord_cartesian()+ ggtitle(paste0(Explosion_Cell,"_",Explosion_Time)) +
geom_vline(data = tmp_df, aes(xintercept = 액보충시간))+
geom_text(data = tmp_df, aes(x = 액보충시간, y = 0, label = c("액보충시간"))) +
labs(subtitle =  paste0("Explosion Plate is ",Explosion_Plate_total,"\n"))
print(p)
p <- ggplot(tmp_df,aes(x=Time,y=Presure,group=Plate_num)) + ylim(min_pressure,max_pressure) +
geom_line(aes(color=Plate_num))+xlab("Time")+ylab("Collector_Presure")+
guides(color = guide_legend(override.aes = list(size = 5))) + scale_color_manual(values=color_P)
p <- p + coord_cartesian()+ ggtitle(paste0(Explosion_Cell,"_",Explosion_Time)) +
geom_vline(data = tmp_df, aes(xintercept = 액보충시간))+
geom_text(data = tmp_df, aes(x = 액보충시간, y = 0, label = c("액보충시간"))) +
labs(subtitle =  paste0("Explosion Plate is ",Explosion_Plate_total,"\n")) + scale_color_manual(values=color_P)
print(p)
# p <- ggplot(tmp_df,aes(x=Time,y=Current,group=Plate_num)) + ylim(min_current,max_current) +
#     geom_line(aes(color=Plate_num))+xlab("Time")+ylab("Plate_Current") +
#     theme(axis.title.x=element_blank(),axis.text.x=element_blank(),axis.ticks.x=element_blank())
#
# p <- p + coord_cartesian()+ ggtitle(paste0(Explosion_Cell,"_",Explosion_Time)) +
#     geom_vline(data = tmp_df, aes(xintercept = 액보충시간))+
#     geom_text(data = tmp_df, aes(x = 액보충시간, y = 0, label = c("액보충시간"))) +
#     labs(subtitle =  paste0("Explosion Plate is ",Explosion_Plate_total,"\n"))
#
#
# q <- ggplot(tmp_df,aes(x=Time,y=Presure,group=Plate_num)) + ylim(min_pressure,max_pressure) +
#     geom_line(aes(color=Plate_num))+xlab("Time")+ylab("Collector_Presure")
# q <- q + coord_cartesian()+
#     geom_vline(data = tmp_df, aes(xintercept = 액보충시간))+
#     geom_text(data = tmp_df, aes(x = 액보충시간, y = 0, label = c("액보충시간")))
#
# grid.arrange(p,q,nrow=2)
}
cell_name <- Explosion_Cell_total[1]
Merge_df_tmp <- Merge_df %>% filter(Item_No ==cell_name)
File_Num <- unique(Merge_df_tmp$File_num)
cat(cell_name,"의 연소 건수",length(File_Num),"건","\n")
for (loop in File_Num) {
tmp_df <- Merge_df_tmp %>% filter(File_num==loop)
cat("연소발생일 : ",tmp_df$연소발생일[1])
if(is.na(unique(tmp_df$연소발생일)[2])==FALSE){
cat("연소발생일 : ",tmp_df$연소발생일[2])
}
Explosion_Cell <- unique(tmp_df$Item_No)
Explosion_Time <- unique(tmp_df$GROUP_endtime)
tmp_df$Time <- as.POSIXct(tmp_df$Time, origin="1899-12-30", tz="GMT")
tmp_df$액보충시간 <- as.POSIXct(tmp_df$액보충시간, origin="1899-12-30", tz="GMT")
p <- ggplot(tmp_df, aes(x = anytime(Time) , y = Plates전류합)) + theme_bw() +
geom_line(position = "identity", alpha = 0.2, bins = 50) +
xlab("Time")+ylab("Plates전류합")+
geom_vline(data = tmp_df, aes(xintercept = 액보충시간)) +
geom_text( aes(x = 액보충시간, y = 0, label = c("액보충시간")))
p <- p + coord_cartesian()+ ggtitle(paste0(Explosion_Cell,"_",Explosion_Time,"_전류"))
print(p)
tmp_df <- Merge_df_tmp %>% filter(File_num==loop)
Explosion_Cell <- unique(tmp_df$Item_No)
Explosion_Time <- unique(tmp_df$GROUP_endtime)
tmp <- colSums(as.data.frame(lapply(tmp_df[,63:87], as.integer)) ,na.rm = FALSE, dims = 1)
Explosion_Plate <- names(tmp[which(tmp>0)])
#전체 연소 Plate 확인
Explosion_Plate_total <- NULL
for (j in 1:length(Explosion_Plate)){
Explosion_Plate_total <- paste(Explosion_Plate_total,Explosion_Plate[j],sep=" ")
}
tmp_df1 <- tmp_df[,c(1:5,31:55,56:58,62)]
tmp_df1 <- tmp_df1 %>% gather(Collector_num,Presure,Collector_압력_151:Collector_압력_175)
tmp_df1$Num <- str_split_fixed(tmp_df1$Collector_num, fixed("_"), 3)[, 3]
tmp_df1$Collector_num <- NULL
tmp_df2 <- tmp_df[,c(1:30,56:58,62)]
tmp_df2 <- tmp_df2 %>% gather(Plate_num,Current,Plate_전류_151:Plate_전류_175)
tmp_df2$Num <- str_split_fixed(tmp_df2$Plate_num, fixed("_"), 3)[, 3]
tmp_df2$Plate_num <- NULL
tmp_df <- merge(tmp_df1, tmp_df2, by = c("File_num","Item_No","연소여부","Time","전류","Plates전류합","액보충시간","GROUP_endtime","GROUP_starttime", "Num")) %>%
arrange(Time);#rm(tmp_df1,tmp_df2)
tmp_df$Plate_num <- paste0("P_",tmp_df$Num)
tmp_df$Collector_num <- paste0("C_",tmp_df$Num)
tmp_df$Num <- NULL
tmp_df$Time <- as.POSIXct(tmp_df$Time, origin="1899-12-30", tz="GMT")
tmp_df$액보충시간 <- as.POSIXct(tmp_df$액보충시간, origin="1899-12-30", tz="GMT")
#연소발생 1시간전 상위Rank+최하Rank+연소 Plate 선별 Drawing
Flag_Time <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-1, unit="hours")
Tmp_df1 <- tmp_df %>%
filter(Time == Flag_Time) %>%
arrange(desc(Current)) %>%
add_column(Rank=1:25,.before = 'Plate_num') %>%
filter((Rank>=1 & Rank<=5)|Rank==25)
Select_Plate <- Tmp_df1$Plate_num;rm(Tmp_df1)
tmp_df <- tmp_df %>% filter(tmp_df[,'Plate_num'] %in% c(Select_Plate, Explosion_Plate))
min_current <- min(tmp_df$Current, na.rm = T)
max_current <- max(tmp_df$Current, na.rm = T)
min_pressure <- min(tmp_df$Presure, na.rm = T)
max_pressure <- max(tmp_df$Presure, na.rm = T)
p <- ggplot(tmp_df,aes(x=Time,y=Current,group=Plate_num)) + ylim(min_current,max_current) +
geom_line(aes(color=Plate_num))+xlab("Time")+ylab("Plate_Current") +
scale_color_manual(values=color_P)
p <- p + coord_cartesian()+ ggtitle(paste0(Explosion_Cell,"_",Explosion_Time)) +
geom_vline(data = tmp_df, aes(xintercept = 액보충시간))+
geom_text(data = tmp_df, aes(x = 액보충시간, y = 0, label = c("액보충시간"))) +
labs(subtitle =  paste0("Explosion Plate is ",Explosion_Plate_total,"\n"))
print(p)
p <- ggplot(tmp_df,aes(x=Time,y=Presure,group=Plate_num)) + ylim(min_pressure,max_pressure) +
geom_line(aes(color=Plate_num))+xlab("Time")+ylab("Collector_Presure")+
scale_color_manual(values=color_C)
p <- p + coord_cartesian()+ ggtitle(paste0(Explosion_Cell,"_",Explosion_Time)) +
geom_vline(data = tmp_df, aes(xintercept = 액보충시간))+
geom_text(data = tmp_df, aes(x = 액보충시간, y = 0, label = c("액보충시간"))) +
labs(subtitle =  paste0("Explosion Plate is ",Explosion_Plate_total,"\n"))
print(p)
# p <- ggplot(tmp_df,aes(x=Time,y=Current,group=Plate_num)) + ylim(min_current,max_current) +
#     geom_line(aes(color=Plate_num))+xlab("Time")+ylab("Plate_Current") +
#     theme(axis.title.x=element_blank(),axis.text.x=element_blank(),axis.ticks.x=element_blank())
#
# p <- p + coord_cartesian()+ ggtitle(paste0(Explosion_Cell,"_",Explosion_Time)) +
#     geom_vline(data = tmp_df, aes(xintercept = 액보충시간))+
#     geom_text(data = tmp_df, aes(x = 액보충시간, y = 0, label = c("액보충시간"))) +
#     labs(subtitle =  paste0("Explosion Plate is ",Explosion_Plate_total,"\n"))
#
#
# q <- ggplot(tmp_df,aes(x=Time,y=Presure,group=Plate_num)) + ylim(min_pressure,max_pressure) +
#     geom_line(aes(color=Plate_num))+xlab("Time")+ylab("Collector_Presure")
# q <- q + coord_cartesian()+
#     geom_vline(data = tmp_df, aes(xintercept = 액보충시간))+
#     geom_text(data = tmp_df, aes(x = 액보충시간, y = 0, label = c("액보충시간")))
#
# grid.arrange(p,q,nrow=2)
}
dddd <- load(file="D:/4.Cell Plate 운전표준수립/YU_JISU/0.Data/N3_RData/raw_data.Rdata")
#packages
if(!require(dplyr)) install.packages('dplyr'); require(dplyr)
if(!require(tidyr)) install.packages('tidyr'); require(tidyr)
if(!require(tidyverse)) install.packages('tidyverse'); require(tidyverse)
if(!require(lubridate)) install.packages('lubridate'); require(lubridate)
#directory - R_code
print(dirname(rstudioapi::getActiveDocumentContext()$path))
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
source("../R_code/Plot_lib.R")
source("../R_code/R_function.R")
# plates 전류합 column 생성
raw_df$Plates전류합<-rowSums(raw_df[,6:30], na.rm = TRUE)
# 연소 별 endtime column 생성
raw_tmp <- raw_df %>%
group_by(File_num,Item_No) %>%
mutate(GROUP_starttime = min(Time)) %>%
mutate(GROUP_endtime = max(Time)) %>%
ungroup
raw_tmp <- raw_tmp %>%
mutate(y_date = ymd_hm(GROUP_endtime)) %>%
mutate(Time = ymd_hm(Time))
# N3 연소발생여부 data에서 Monel Type filtering
N3_Explosion_tmp <- N3_Explosion_DF %>%
mutate(y=1, y_date=ymd_hm(연소발생일),액보충시간=ymd_hm(액보충시간)) %>%
filter(Cell종류=="Monel") %>%
select(-c('연소발생월','연소발생일','Cell종류'))
# file numbering loop
# cell, y_date 같은 것끼리 붙이기
merge_tmp <- merge(raw_tmp, N3_Explosion_tmp,
by= c('Item_No','y_date'), all.x = TRUE)
merge_tmp[,70:95] <-  sapply(merge_tmp[,70:95], function(x) {ifelse(is.na(x),0,x)})
total_df <- merge_tmp  %>%
select(c('File_num','Item_No','y_date','y',everything())) %>%
arrange('File_num','Item_No','Time')
str(total_df)
# (save2) -------------------------------------------------------------------
save(total_df,file = "D:/4.Cell Plate 운전표준수립/YU_JISU/0.Data/N3_RData/total_data.Rdata")
rm(list=ls())
# 00. environment -------------------------------------------------------------
#packages
if(!require(dplyr)) install.packages('dplyr'); require(dplyr)
if(!require(tidyr)) install.packages('tidyr'); require(tidyr)
if(!require(tidyverse)) install.packages('tidyverse'); require(tidyverse)
if(!require(lubridate)) install.packages('lubridate'); require(lubridate)
#directory - R_code
print(dirname(rstudioapi::getActiveDocumentContext()$path))
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
#Rdata load
load(file="D:/4.Cell Plate 운전표준수립/YU_JISU/0.Data/N3_RData/total_data.Rdata")
tmp01 <- total_df %>% select(c('File_num','Item_No','y_date','y'))
tmp01 <- tmp01[!duplicated(tmp01), ] %>%
arrange(File_num) %>%
filter(y=="1") %>%
mutate(before_Item_No = lag(Item_No), before_y_date = lag(y_date)) %>%
mutate(err = I(y_date - before_y_date < 48*60 & before_Item_No != Item_No))
View(tmp01)
View(tmp01)
tmp01 <- tmp01 %>% filter(err==1)
Err_File_num <- tmp01$File_num
Err_Item_No <- tmp01$before_Item_No
for (i in 1:length(Err_File_num)){
total_df <- subset(total_df,File_num != Err_File_num[i]
| Item_No != Err_Item_No[i])
}
rm(list=ls())
#packages
if(!require(dplyr)) install.packages('dplyr'); require(dplyr)
if(!require(tidyr)) install.packages('tidyr'); require(tidyr)
if(!require(tidyverse)) install.packages('tidyverse'); require(tidyverse)
#directory - R_code
print(dirname(rstudioapi::getActiveDocumentContext()$path))
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
#Rdata load
load(file="../0.Data/N3_RData/prep01_data.Rdata")
summary(prep01_df)
View(prep01_df)
time_df <- NULL
#for (i in 81:89){
i <- 0
# time window 분할 ----------------------------------------------------------
rm(time_df)
hour_df <- prep01_df
hour_df <- prep01_df
hour_df$Time <- as.POSIXct(time_df$Time, origin="1899-12-30", tz="GMT")
hour_df$Time <- as.POSIXct(hour_df$Time, origin="1899-12-30", tz="GMT")
hour_df$y_date <- as.POSIXct(hour_df$y_date, origin="1899-12-30", tz="GMT")
Explosion_Time <- unique(hour_df$y_date)
View(prep01_df)
# N-3_RI-110A-58.csv 데이터 에러
#
tmp02 <- prep01_df %>% filter(File_num!=58 | Item_No != "I-A" )
# N-3_RI-110A-58.csv 데이터 에러
# 7,635,901 -> 7,634,136
prep02_df <- tmp02
save(prep02_df,file = "D:/4.Cell Plate 운전표준수립/YU_JISU/0.Data/N3_RData/prep02_data.Rdata")
#Rdata load
load(file="../0.Data/N3_RData/prep02_data.Rdata")
hour_df <- prep02_df
hour_df$Time <- as.POSIXct(hour_df$Time, origin="1899-12-30", tz="GMT")
hour_df$y_date <- as.POSIXct(hour_df$y_date, origin="1899-12-30", tz="GMT")
Explosion_Time <- unique(hour_df$y_date)
t1 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-1, unit="hours")
t1 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-1, unit="hours")
t2 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-3, unit="hours")
t3 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-6, unit="hours")
t4 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-12, unit="hours")
t5 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-24, unit="hours")
i<-1
i<-1
hour_df$before_h <- if(File_num==i-1 & t1[i]<=hour_df$Time<=y_date[i],"1h")
hour_df$before_h <- ifelse(File_num==i-1 & t1[i]<=hour_df$Time<=y_date[i],"1h")
hour_df$before_h <- ifelse(File_num==i-1 & t1[i]<=hour_df$Time<=y_date[i],"1h",)
i<-1
hour_df$before_h <- ifelse(File_num==i-1 & t1[i]<=hour_df$Time<=y_date[i],"1h",NA)
hour_df$before_h <- ifelse(File_num==i-1 & t1[i]<= hour_df$Time =< y_date[i],"1h",NA)
hour_df$before_h <- ifelse(File_num==i-1 & t1[i] < hour_df$Time < y_date[i],"1h",NA)
i<-1
i<-1
hour_df$before_h <- ifelse(File_num==i-1 &hour_df$Time >= t1[i],"1h",NA)
View(prep02_df)
i<-1
hour_df$before_h <- ifelse(hour_df$File_num==i-1 &hour_df$Time >= t1[i],"1h",NA)
View(hour_df)
hour_df$before_h <- ifelse(hour_df$File_num==i-1 & hour_df$Time >= t1[i] & hour_df$Time <= Explosion_Time[i],"1h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t2[i] & hour_df$Time < t1[i] ,"3h",NA
))
View(hour_df)
i<-1
hour_df$before_h <- ifelse(hour_df$File_num==i-1 & hour_df$Time >= t1[i] & hour_df$Time <= Explosion_Time[i],"1h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t2[i] & hour_df$Time < t1[i] ,"3h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t3[i] & hour_df$Time < t2[i] ,"6h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t4[i] & hour_df$Time < t3[i] ,"12h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t5[i] & hour_df$Time < t4[i] ,"24h",
ifelse(hour_df$File_num==i-1 & hour_df$Time < t5[i] ,"48h",NA))))))
View(hour_df)
tmp <- hour_df %>% filter(File_num==i-1)
View(tmp)
tmp <- hour_df %>% filter(File_num==i-1) %>% select(c('File_num','Item_No','Time','y','before_h'))
View(tmp)
tmp <- hour_df %>% filter(File_num==i-1) %>% select(c('File_num','Item_No','Time','y','before_h')) %>% arrange(File_num,Item_No,Time)
View(tmp)
#i<-1
for (i in 1:90){
hour_df$before_h <- ifelse(hour_df$File_num==i-1 & hour_df$Time >= t1[i] & hour_df$Time <= Explosion_Time[i],"1h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t2[i] & hour_df$Time < t1[i] ,"3h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t3[i] & hour_df$Time < t2[i] ,"6h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t4[i] & hour_df$Time < t3[i] ,"12h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t5[i] & hour_df$Time < t4[i] ,"24h",
ifelse(hour_df$File_num==i-1 & hour_df$Time < t5[i] ,"48h",NA))))))
}
#확인
#tmp <- hour_df %>% filter(File_num==i-1) %>% select(c('File_num','Item_No','Time','y','before_h')) %>% arrange(File_num,Item_No,Time)
tmp <- hour_df %>% select(c('File_num','Item_No','Time','y','before_h')) %>% arrange(File_num,Item_No,Time)
View(tmp)
View(hour_df)
#i<-1
hour_df$before_h <- NULL
#i<-1
hour_df$before_h <- NULL
#i<-1
hour_df$before_h <- NULL
for (i in 1:2){
hour_df$before_h <- ifelse(hour_df$File_num==i-1 & hour_df$Time >= t1[i] & hour_df$Time <= Explosion_Time[i],"1h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t2[i] & hour_df$Time < t1[i] ,"3h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t3[i] & hour_df$Time < t2[i] ,"6h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t4[i] & hour_df$Time < t3[i] ,"12h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t5[i] & hour_df$Time < t4[i] ,"24h",
ifelse(hour_df$File_num==i-1 & hour_df$Time < t5[i] ,"48h",hour_df$before_h))))))
}
View(hour_df)
hour_df <- prep02_df
hour_df$Time <- as.POSIXct(hour_df$Time, origin="1899-12-30", tz="GMT")
hour_df$y_date <- as.POSIXct(hour_df$y_date, origin="1899-12-30", tz="GMT")
Explosion_Time <- unique(hour_df$y_date)
t1 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-1, unit="hours")
t2 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-3, unit="hours")
t3 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-6, unit="hours")
t4 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-12, unit="hours")
t5 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-24, unit="hours")
#i<-1
hour_df$before_h <- NULL
for (i in 1:2){
hour_df$before_h <- ifelse(hour_df$File_num==i-1 & hour_df$Time >= t1[i] & hour_df$Time <= Explosion_Time[i],"1h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t2[i] & hour_df$Time < t1[i] ,"3h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t3[i] & hour_df$Time < t2[i] ,"6h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t4[i] & hour_df$Time < t3[i] ,"12h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t5[i] & hour_df$Time < t4[i] ,"24h",
ifelse(hour_df$File_num==i-1 & hour_df$Time < t5[i] ,"48h",NULL))))))
}
View(hour_df)
#i<-1
for (i in 1:2){
if(hour_df$File_num==i-1){
hour_df$before_h <- ifelse(hour_df$Time >= t1[i] & hour_df$Time <= Explosion_Time[i],"1h",
ifelse(hour_df$Time >= t2[i] & hour_df$Time < t1[i] ,"3h",
ifelse( hour_df$Time >= t3[i] & hour_df$Time < t2[i] ,"6h",
ifelse(hour_df$Time >= t4[i] & hour_df$Time < t3[i] ,"12h",
ifelse(hour_df$Time >= t5[i] & hour_df$Time < t4[i] ,"24h",
ifelse(hour_df$Time < t5[i] ,"48h",""))))))
}
}
View(hour_df)
#i<-1
for (i in 1:2){
if(hour_df$File_num==i-1){
hour_df$before_h <- ifelse(hour_df$Time >= t1[i] & hour_df$Time <= Explosion_Time[i],"1h",
ifelse(hour_df$Time >= t2[i] & hour_df$Time < t1[i] ,"3h",
ifelse( hour_df$Time >= t3[i] & hour_df$Time < t2[i] ,"6h",
ifelse(hour_df$Time >= t4[i] & hour_df$Time < t3[i] ,"12h",
ifelse(hour_df$Time >= t5[i] & hour_df$Time < t4[i] ,"24h",
ifelse(hour_df$Time < t5[i] ,"48h",""))))))
}else{
hour_df$before_h <-hour_df$before_h }
}
for (i in 1:2){
hour_df$before_h <- ifelse(hour_df$File_num==i-1 & hour_df$Time >= t1[i] & hour_df$Time <= Explosion_Time[i],"1h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t2[i] & hour_df$Time < t1[i] ,"3h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t3[i] & hour_df$Time < t2[i] ,"6h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t4[i] & hour_df$Time < t3[i] ,"12h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t5[i] & hour_df$Time < t4[i] ,"24h",
ifelse(hour_df$File_num==i-1 & hour_df$Time < t5[i] ,"48h",""))))))
}
i<-1
for (i in 1:5){
if(hour_df$File_num==i-1 & hour_df$Time >= t1[i] & hour_df$Time <= Explosion_Time[i]){
hour_df$before_h <- "1h"
}
}
for (i in 1:5){
if(hour_df$File_num==i-1 & hour_df$Time >= t1[i] & hour_df$Time <= Explosion_Time[i]){
hour_df$before_h <- "1h"
}else{
hour_df$before_h <- hour_df$before_h
}
}
View(hour_df)
hour_df <- prep02_df
hour_df$Time <- as.POSIXct(hour_df$Time, origin="1899-12-30", tz="GMT")
hour_df$y_date <- as.POSIXct(hour_df$y_date, origin="1899-12-30", tz="GMT")
Explosion_Time <- unique(hour_df$y_date)
t1 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-1, unit="hours")
t2 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-3, unit="hours")
t3 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-6, unit="hours")
t4 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-12, unit="hours")
t5 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-24, unit="hours")
for (i in 1:5){
if(hour_df$File_num==i-1 &( hour_df$Time >= t1[i] & hour_df$Time <= Explosion_Time[i])){
hour_df$before_h <- "1h"
}else{
hour_df$before_h <- hour_df$before_h
}
}
for (i in 1:5){
if(hour_df$File_num==i-1 &( hour_df$Time >= t1[i] & hour_df$Time <= Explosion_Time[i])){
hour_df$before_h <- "1h"
}
}
hour_df <- prep02_df
hour_df$Time <- as.POSIXct(hour_df$Time, origin="1899-12-30", tz="GMT")
hour_df$y_date <- as.POSIXct(hour_df$y_date, origin="1899-12-30", tz="GMT")
Explosion_Time <- unique(hour_df$y_date)
t1 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-1, unit="hours")
t2 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-3, unit="hours")
t3 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-6, unit="hours")
t4 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-12, unit="hours")
t5 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-24, unit="hours")
i<-1
hour_df$before_h <- NULL
View(hour_df)
hour_df$before_h <- NA
hour_df$before_h <- ifelse(hour_df$File_num==i-1 & hour_df$Time >= t1[i] & hour_df$Time <= Explosion_Time[i],"1h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t2[i] & hour_df$Time < t1[i] ,"3h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t3[i] & hour_df$Time < t2[i] ,"6h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t4[i] & hour_df$Time < t3[i] ,"12h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t5[i] & hour_df$Time < t4[i] ,"24h",
ifelse(hour_df$File_num==i-1 & hour_df$Time < t5[i] ,"48h",hour_df$before_h))))))
hour_df$before_h <- NA
for (i in 1:2){
hour_df$before_h <- ifelse(hour_df$File_num==i-1 & hour_df$Time >= t1[i] & hour_df$Time <= Explosion_Time[i],"1h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t2[i] & hour_df$Time < t1[i] ,"3h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t3[i] & hour_df$Time < t2[i] ,"6h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t4[i] & hour_df$Time < t3[i] ,"12h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t5[i] & hour_df$Time < t4[i] ,"24h",
ifelse(hour_df$File_num==i-1 & hour_df$Time < t5[i] ,"48h",hour_df$before_h))))))
}
#확인
tmp <- hour_df %>% filter(File_num==i-1,File_num==i) %>% select(c('File_num','Item_No','Time','y','before_h')) %>% arrange(File_num,Item_No,Time)
tmp <- hour_df %>% select(c('File_num','Item_No','Time','y','before_h')) %>% arrange(File_num,Item_No,Time)
View(tmp)
hour_df <- prep02_df
hour_df$Time <- as.POSIXct(hour_df$Time, origin="1899-12-30", tz="GMT")
hour_df$y_date <- as.POSIXct(hour_df$y_date, origin="1899-12-30", tz="GMT")
Explosion_Time <- unique(hour_df$y_date)
t1 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-1, unit="hours")
t2 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-3, unit="hours")
t3 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-6, unit="hours")
t4 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-12, unit="hours")
t5 <- as.POSIXct(Explosion_Time,origin="1899-12-30",tz="GMT") + as.difftime(-24, unit="hours")
hour_df$before_h <- NA
for (i in 1:10){
hour_df$before_h <- ifelse(hour_df$File_num==i-1 & hour_df$Time >= t1[i] & hour_df$Time <= Explosion_Time[i],"1h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t2[i] & hour_df$Time < t1[i] ,"3h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t3[i] & hour_df$Time < t2[i] ,"6h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t4[i] & hour_df$Time < t3[i] ,"12h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t5[i] & hour_df$Time < t4[i] ,"24h",
ifelse(hour_df$File_num==i-1 & hour_df$Time < t5[i] ,"48h",hour_df$before_h))))))
}
#확인
#tmp <- hour_df %>% filter(File_num==i-1) %>% select(c('File_num','Item_No','Time','y','before_h')) %>% arrange(File_num,Item_No,Time)
tmp <- hour_df %>% select(c('File_num','Item_No','Time','y','before_h')) %>% arrange(File_num,Item_No,Time)
View(tmp)
#확인
#tmp <- hour_df %>% filter(File_num==i-1) %>% select(c('File_num','Item_No','Time','y','before_h')) %>% arrange(File_num,Item_No,Time)
tmp <- hour_df %>% select(c('File_num','Item_No','Time','y','before_h')) %>% arrange(File_num,Item_No,Time)
for (i in 11:90){
hour_df$before_h <- ifelse(hour_df$File_num==i-1 & hour_df$Time >= t1[i] & hour_df$Time <= Explosion_Time[i],"1h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t2[i] & hour_df$Time < t1[i] ,"3h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t3[i] & hour_df$Time < t2[i] ,"6h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t4[i] & hour_df$Time < t3[i] ,"12h",
ifelse(hour_df$File_num==i-1 & hour_df$Time >= t5[i] & hour_df$Time < t4[i] ,"24h",
ifelse(hour_df$File_num==i-1 & hour_df$Time < t5[i] ,"48h",hour_df$before_h))))))
}
View(tmp)
#확인
tmp <- hour_df %>% select(c('File_num','Item_No','Time','y','before_h')) %>% arrange(File_num,Item_No,Time)
View(tmp)
na <- tmp[is.na(tmp$before_df),]
View(hour_df)
with(hour_df,table(before_h))
View(hour_df)
View(hour_df)
save(hour_df, file="../0.Data/N3_RData/hour_data.Rdata")
tmpp <- tmp %>% filter(File_num==0)
with(tmpp,table(before_h))
1830/6
1830/60
tmpp <- tmp %>% group_by(File_num)
with(tmpp,table(before_h))
1830/61
ls()
ls()[-hour_df]
ls()[-'hour_df']
ls()[-2]
rm(list=ls()[-2])
str(hour_df)
View(hour_df)
hour_df$Plates_전류sd <- sd(hour_df[,7:31])
hour_df$Plates_전류sd <- sd(hour_df[,7:31],na.rm=T)
hour_df$Plates_전류sd <- rowSds(hour_df[,7:31],na.rm=T)
??rowSds
